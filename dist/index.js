"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Event=function(){function e(t){_classCallCheck(this,e),this.obj=t}return _createClass(e,[{key:"appendTo",value:function(e){var t=document.createElement("article");t.className="event";var n=new Details(this.obj),a=new Description(this.obj),i=new Statistics(this.obj);n.appendTo(t),a.appendTo(t),i.appendTo(t),e.appendChild(t)}}]),e}(),Description=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).description=n.obj.mdr_text.filter(function(e){return"Description of Event or Problem"===e.text_type_code})[0].text,n}return _inherits(t,Event),_createClass(t,[{key:"descriptionSection",value:function(){var e=document.createDocumentFragment(),t=document.createElement("h2");t.appendChild(document.createTextNode("Description of event or problem"));var n=document.createElement("p");return n.appendChild(document.createTextNode(this.description)),e.appendChild(t),e.appendChild(n),e}},{key:"appendTo",value:function(e){var t=document.createElement("section");t.className="event-description",t.appendChild(this.descriptionSection()),e.appendChild(t)}}]),t}(),Details=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).date=n.obj.date_of_event,n.device=n.obj.device[0].openfda.device_name,n}return _inherits(t,Event),_createClass(t,[{key:"dateSection",value:function(){var e=document.createElement("div");e.className="event-details-block";var t=document.createElement("h2");t.appendChild(document.createTextNode("Date"));var n=document.createElement("p");return n.appendChild(document.createTextNode(function(e){if(void 0!==e){var t=Number(e.substring(0,4)),n=Number(e.substring(4,6))-1,a=Number(e.substring(6,8));return new Date(t,n,a).toDateString().substring(4)}return"Unknown"}(this.date))),e.appendChild(t),e.appendChild(n),e}},{key:"deviceSection",value:function(){var e=document.createElement("div");e.className="event-details-block";var t=document.createElement("h2");t.appendChild(document.createTextNode("Device"));var n=document.createElement("p");return n.appendChild(document.createTextNode(this.device)),e.appendChild(t),e.appendChild(n),e}},{key:"appendTo",value:function(e){var t=document.createElement("section");t.className="event-details";var n=document.createDocumentFragment();n.appendChild(this.dateSection()),n.appendChild(this.deviceSection()),t.appendChild(n),e.appendChild(t)}}]),t}(),Statistics=function(e){function t(e){var n;return _classCallCheck(this,t),(n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).device=n.obj.device[0].openfda.device_name,n.fatalitiesCount="",n.maxFatalitiesCount="",n}return _inherits(t,Event),_createClass(t,[{key:"stringSection",value:function(){var e=document.createElement("div");e.className="event-statistics-block";var t=document.createElement("h2");t.appendChild(document.createTextNode("Statistics"));var n=document.createElement("p");if(void 0!==this.fatalities){var a=document.createElement("strong");a.appendChild(document.createTextNode(this.fatalitiesCount)),n.appendChild(a),n.appendChild(document.createTextNode(" reported fatalities have been caused by this kind of device"))}else n.appendChild(document.createTextNode("No statistics are availble for this device."));return e.appendChild(t),e.appendChild(n),e}},{key:"graphSection",value:function(){var e=document.createElement("div");if(e.className="event-statistics-block",void 0!==this.fatalities){var t=document.createElement("figure");t.className="bar-graph";var n=document.createElement("div");n.className="bar-container";var a=document.createElement("div");a.className="bar-graph-scale",t.appendChild(n),t.appendChild(a),e.appendChild(t),d3.select(n).selectAll("div").data([this.fatalities]).enter().append("div").attr("class","bar").style("width","".concat(this.fatalities/this.maxFatalities*100,"%"));var i=d3.select(a).selectAll("span").data([0,this.maxFatalities]);i.enter().append("span").merge(i).text(function(e){return e})}return e}},{key:"appendTo",value:function(e){var t=this,n=document.createElement("section");n.className="event-statistics",sendHttpRequest(URL.DEVICENAMES,function(a){a.results.filter(function(e){return e.term===t.device}).length>0?t.fatalities=a.results.filter(function(e){return e.term===t.device})[0].count:t.fatalities=void 0,t.maxFatalities=a.results[0].count,n.appendChild(t.stringSection()),n.appendChild(t.graphSection()),e.appendChild(n)})}},{key:"fatalities",set:function(e){this.fatalitiesCount=e},get:function(){return this.fatalitiesCount}},{key:"maxFatalities",set:function(e){this.maxFatalitiesCount=e},get:function(){return this.maxFatalitiesCount}}]),t}(),renderBarGraph=function(e,t){d3.select(".bar-container").selectAll("div").data([e]).enter().append("div").attr("class","bar").style("width","".concat(e/t*100,"%"));var n=d3.select(".bar-graph-scale").selectAll("span").data([0,t]);n.enter().append("span").merge(n).text(function(e){return e})},sendHttpRequest=function(e,t){var n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");n.open("GET",e,!0),n.onreadystatechange=function(){4===n.readyState&&n.status>=200&&n.status<300&&t(JSON.parse(n.responseText))},n.send()},TARGET=document.getElementById("target"),URL={EVENTS:"https://api.fda.gov/device/event.json?search=event_type:death&limit=100",DEVICENAMES:"https://api.fda.gov/device/event.json?search=event_type:death&count=device.openfda.device_name.exact"};window.onload=function(){sendHttpRequest(URL.EVENTS,function(e){for(var t=0;t<e.results.length;t++)new Event(e.results[t]).appendTo(TARGET)})};